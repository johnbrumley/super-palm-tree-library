<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Dropzone.js Example</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">    
    <link rel="stylesheet" href="/dropzone/dist/dropzone.css">        
    <meta name="csrf-token" content="XYZ123">
</head>
<body>

	<div class="container">

		<header>
			<h1>Dropzone.js Example</h1>
		</header>

		<div>
			<form id="upload-widget" method="post" action="/upload" class="dropzone">
				<div class="fallback">
					<input name="file" type="file" />
  			</div>
			</form>
		</div>

		<footer style="margin-top:500px;">
			<p>This demo is designed to accompany <a href="http://www.sitepoint.com/ARTICLE-URL">this article</a>.</p>
		</footer>

	</div>
  <script type="text/javascript" src="/jquery/dist/jquery.min.js"></script>    
  <script type="text/javascript" src="/dropzone/dist/dropzone.js"></script>    
  <script type="text/javascript">
    Dropzone.options.uploadWidget = {  
		  paramName: 'file',
		  maxFilesize: 100, // MB		
		  autoProcessQueue: true,  
		  dictDefaultMessage: 'Drag an pdf here to upload, or click to select one',
		  headers: {
			'x-csrf-token': document.querySelectorAll('meta[name=csrf-token]')[0].getAttributeNode('content').value,
		  },
		  acceptedFiles: 'application/pdf',	
		  success: function(file, response){
		  	filePath = response.path.substring(0, response.path.lastIndexOf("/"));
		  	fileName = response.originalname; 
 		  	$(file.previewTemplate).append('<span class="server_file" style="display:none;">'+filePath+'/'+fileName+'</span>');
			

		  },
		  init: function() {
		      this.on("addedfile", function(file) {

		        // Create the remove button
		        var removeButton = Dropzone.createElement("<button>Remove file</button>");


		        // Capture the Dropzone instance as closure.
		        var _this = this;

		        // Listen to the click event
		        removeButton.addEventListener("click", function(e) {
		          	// Make sure the button click doesn't submit the form:
		          	e.preventDefault();
		          	e.stopPropagation();
	
		          	// Remove the file preview.
		          	_this.removeFile(file);
		          	// If you want to the delete the file on the server as well,
		          	// you can do the AJAX request here.
		          	var server_file = $(file.previewTemplate).children('.server_file').text();
		          	console.log(server_file);
  					//alert(server_file);
  					// Do a post request and pass this path and use server-side language to delete the file
					// ADD POPUP ARE YOU SURE YOU WANT TO DELETE///  					
  					$.post("http://localhost:8080/delete",{filePath: server_file}, function(data){});
		        });

		        // Add the button to the file preview element.
		        file.previewElement.appendChild(removeButton);
		      });
		    },
		 	  
		  /*init: function() {	    
		  	console.log('made it1');
		  	this.on('success', function( file, resp ){
		  		console.log( file );
		  		console.log( resp );
		  	});
		    this.on('thumbnail', function(file) {	      
		        console.log('made it3');
		    });
		  },*/
		  accept: function(file, done) {
		  	console.log(file);
		    done(); 
		  }		  
		};	
  </script>

</body>
</html>
